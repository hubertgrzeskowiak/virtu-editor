!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.X2JS=t()}(this,function(){return function(e){"use strict";function t(){void 0===e.escapeMode&&(e.escapeMode=!0),e.attributePrefix=e.attributePrefix||"_",e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1),e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1),void 0===e.keepOrder&&(e.keepOrder=!1),e.orderContainerName=e.orderContainerName||"x2jsOrderContainer",e.arrayOrderItems=e.arrayOrderItems||[]}function r(){}function n(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function i(e){return e.prefix}function a(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function o(e,t,r,n){for(var i=0;i<e.length;i++){var a=e[i];if("string"==typeof a){if(a==n)break}else if(a instanceof RegExp){if(a.test(n))break}else if("function"==typeof a&&a(t,r,n))break}return i!=e.length}function s(t,r,n){switch(e.arrayAccessForm){case"property":t[r]instanceof Array?t[r+"_asArray"]=t[r]:t[r+"_asArray"]=[t[r]]}!(t[r]instanceof Array)&&e.arrayAccessFormPaths.length>0&&o(e.arrayAccessFormPaths,t,r,n)&&(t[r]=[t[r]])}function l(e){var t=e.split(/[-T:+Z]/g),r=new Date(t[0],t[1]-1,t[2]),n=t[5].split(".");if(r.setHours(t[3],t[4],n[0]),n.length>1&&r.setMilliseconds(n[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]),a=/\d\d-\d\d:\d\d$/.test(e)?"-":"+";i=0+("-"==a?-1*i:i),r.setMinutes(r.getMinutes()-i-r.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds())));return r}function c(t,r,n){if(e.datetimeAccessFormPaths.length>0){var i=n.split(".#")[0];return o(e.datetimeAccessFormPaths,t,r,i)?l(t):t}return t}function u(t,r,n,i){return r==T.ELEMENT_NODE&&e.xmlElementsFilter.length>0?o(e.xmlElementsFilter,t,n,i):!0}function f(t,r){if(t.nodeType==T.DOCUMENT_NODE){for(var a=new Object,o=t.childNodes,l=0;l<o.length;l++){var _=o.item(l);if(_.nodeType==T.ELEMENT_NODE){var d=n(_);a[d]=f(_,d)}}return a}if(t.nodeType==T.ELEMENT_NODE){var a=new Object;a.__cnt=0;for(var o=t.childNodes,l=0;l<o.length;l++){var _=o.item(l),d=n(_);if(_.nodeType!=T.COMMENT_NODE){var p=r+"."+d;if(u(a,_.nodeType,d,p))if(a.__cnt++,null==a[d]){var m=e.arrayOrderItems.indexOf(d)>=0;if(e.keepOrder&&e.arrayOrderItems.length>0)if(m&&(a.hasOwnProperty(e.orderContainerName)||(a[e.orderContainerName]=new Array)),e.arrayOrderItems.indexOf(d)>=0){if(a.hasOwnProperty(e.orderContainerName)&&"#text"!=d){var x={};x[d]=f(_,p),a[e.orderContainerName].push(x)}}else a[d]=f(_,p);else a[d]=f(_,p);s(a,d,p)}else null!=a[d]&&(a[d]instanceof Array||(a[d]=[a[d]],s(a,d,p))),a[d][a[d].length]=f(_,p)}}for(var g=0;g<t.attributes.length;g++){var h=t.attributes.item(g);a.__cnt++,a[e.attributePrefix+h.name]=h.value}var y=i(t);return null!=y&&""!=y&&(a.__cnt++,a.__prefix=y),null!=a["#text"]&&(a.__text=a["#text"],a.__text instanceof Array&&(a.__text=a.__text.join("\n")),e.stripWhitespaces&&(a.__text=a.__text.trim()),delete a["#text"],"property"==e.arrayAccessForm&&delete a["#text_asArray"],a.__text=c(a.__text,d,r+"."+d)),null!=a["#cdata-section"]&&(a.__cdata=a["#cdata-section"],delete a["#cdata-section"],"property"==e.arrayAccessForm&&delete a["#cdata-section_asArray"]),0==a.__cnt&&"text"==e.emptyNodeForm?a="":1==a.__cnt&&null!=a.__text?a=a.__text:1!=a.__cnt||null==a.__cdata||e.keepCData?a.__cnt>1&&null!=a.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==a.__text||""==a.__text.trim())&&delete a.__text:a=a.__cdata,delete a.__cnt,!e.enableToStringFunc||null==a.__text&&null==a.__cdata||(a.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),a}return t.nodeType==T.TEXT_NODE||t.nodeType==T.CDATA_SECTION_NODE?t.nodeValue:void 0}function _(t,r,n,i){var o="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+r;if(null!=n)for(var s=0;s<n.length;s++){var l=n[s],c=t[l];e.escapeMode&&(c=a(c)),o+=" "+l.substr(e.attributePrefix.length)+"=",o+=e.useDoubleQuotes?'"'+c+'"':"'"+c+"'"}return o+=i?"/>":">"}function d(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function p(e,t){return-1!==e.indexOf(t,e.length-t.length)}function m(t,r){return!!("property"==e.arrayAccessForm&&p(r.toString(),"_asArray")||0==r.toString().indexOf(e.attributePrefix)||0==r.toString().indexOf("__")||t[r]instanceof Function)}function x(e){var t=0;if(e instanceof Object)for(var r in e)m(e,r)||t++;return t}function g(t,r,n){return 0==e.jsonPropertiesFilter.length||""==n||o(e.jsonPropertiesFilter,t,r,n)}function h(t){var r=[];if(t instanceof Object)for(var n in t)-1==n.toString().indexOf("__")&&0==n.toString().indexOf(e.attributePrefix)&&r.push(n);return r}function y(t){var r="";return null!=t.__cdata&&(r+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(r+=e.escapeMode?a(t.__text):t.__text),r}function O(t){var r="";return t instanceof Object?r+=y(t):null!=t&&(r+=e.escapeMode?a(t):t),r}function v(e,t){return""===e?t:e+"."+t}function N(t,r,n,i){var a="";if(0==t.length)a+=_(t,r,n,!0);else if(e.keepOrder)for(var o=0;o<t.length;o++)r!=e.orderContainerName&&(a+=_(t[o],r,h(t[o]),!1)),a+=E(t[o],v(i,r)),r!=e.orderContainerName&&(a+=d(t[o],r));else for(var o=0;o<t.length;o++)a+=_(t[o],r,h(t[o]),!1),a+=E(t[o],v(i,r)),a+=d(t[o],r);return a}function E(e,t){var r="",n=x(e);if(n>0)for(var i in e)if(!m(e,i)&&(""==t||g(e,i,v(t,i)))){var a=e[i],o=h(a);if(null==a||void 0==a)r+=_(a,i,o,!0);else if(a instanceof Object)if(a instanceof Array)r+=N(a,i,o,t);else if(a instanceof Date)r+=_(a,i,o,!1),r+=a.toISOString(),r+=d(a,i);else{var s=x(a);s>0||null!=a.__text||null!=a.__cdata?(r+=_(a,i,o,!1),r+=E(a,v(t,i)),r+=d(a,i)):r+=_(a,i,o,!0)}else r+=_(a,i,o,!1),r+=O(a),r+=d(a,i)}return r+=O(e)}var A="1.2.0";e=e||{},t(),r();var T={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(e){var t=window.ActiveXObject||"ActiveXObject"in window;if(void 0===e)return null;var r;if(window.DOMParser){var n=new window.DOMParser,i=null;if(!t)try{i=n.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(a){i=null}try{r=n.parseFromString(e,"text/xml"),null!=i&&r.getElementsByTagNameNS(i,"parsererror").length>0&&(r=null)}catch(a){r=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(e);return r},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?l(e):e},this.xml2json=function(e){return f(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return E(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return A}}});
